## 논리회로설계

VHDL을 이용해 final project를 진행했던 과정입니다.
아래는 최종 기말 프로젝트 나타내었습니다.

## 최종 기말 프로젝트
### **주제명**  : fsm을 이용한 자판기 설계 

**프로그램 설계**

프로젝트를 수행하면서 프로그램의 시나리오를 어떻게 구성할지 생각하였습니다. 다음은 3가지의 시나리오와 결론, 제 생각을 담은 맺음말로 구성되어있습니다.


**프로그램 분석**

#### 1. INPUT과 OUTPUT signal 분석
<input>
in_50won,in_100won,in_500won : 동전입력signal( 자판기에 투입되는 동전을 의미)
button_coffee: 커피 출력 버튼(자판기에 커피를 출력하라는 명령을 전달)
button_tea: tea 출력 버튼(자판기에 tea를 출력하라는 명령을 전달)
clk : 상태머신의 입/출력의 반응주기 (클락 주기 signal) . 상승엣지(rising edge)에 반응하도록 설정  
button_return_money : 동전 반환 버튼 (자판기에 잔액 반환signal 전달)
button_reset : 리셋 버튼( 자판기에 들어있는 모든 돈을 반환 없이 리셋하라는 신호 전달)
<output>
coffee_out : 커피 출력신호에 의한 실제 커피출력 
tea_out : tea 출력시그널에 의한 실제 tea출력
nomoney : 커피나 tea 버튼을 눌렀지만 자판기 현재 상태에 돈이 부족해서 커피나 티를 뽑을수 없다는 signal
coin_out_50,coin_out_100,coin_out_500 : 반환된 동전 출력에 대한 신호


#### 2. architecture 코드분석 – state 분석
- 유한상태머신 (FSM)을 통해 자판기를 설계하기 위해 먼저 현재 자판기에 들어있는 돈의 액수에 따라 상태를 정의한다.
자판기의 최대 허용 금액이 700원 이므로, 0원~700원 까지를 50원 단위로 m0부터 m750까지 총 15개의 상태를 정의한다. 700원이 최대 허용 금액이므로 그 이상의 상태로의 이동은 일어나지 않고 그 이상의 돈을 넣는 행위가 일어날 시에는 그 이상의 돈을 그대로 반환하는 알고리즘을 선택했다. 각각의 상태에서 들어올 수 있는 모든 입력 신호에 대해 ( 동전 입력, 커피 출력 버튼 신호 등에 따른 ‘상태의 이동(천이)’과 ‘출력신호’를 설정하여 작동하는 것이 기본 원리이다. 


#### 3. architecture 코드분석 – 각각의 state에서의 동작 분석 

- 모든 동작은 클럭신호의 주기에 따라 반응하도록 설계하였다. VHDL에서 case 문과 if문을 중점적으로 사용하여 state와 state의 이동을  구현하였다. 
우선 자판기에 reset signal은 자판기가 어떤 state에 있던지간에 상관하지 않고 자판기 state가 m0인 0원상태로 이동하게 된다. 만약에 reset signal이 
들어오지 않는다면 자판기의 state들은 m0~m700사이의 state에 존재하게 될 것이고, 각 state에서 input으로 들어오는 50원 100원 500원 동전에 의해
서 state들이 이동하게 될 것이다.각각의 state에서 돈을 입력받는 상태를 알아보자면, m0일 때 50원이 들어오면 m50상태로 이동, 100원이 들어오면 m100상태 이동, 500원이 들어오면 m500상태로 이동할 것이다. 만약 m300상태에서 500원이 들어오면 최종금액인 700원을 넘게 되어 out에 500원을 return 해주고 m300을 유지해 다음 클럭에서 다시 금액을 받게 될 것이다. 이런 식으로 초과가 되어 들어오는 돈은 반환시키게 된다. 두 번째로 커피나 차를 입력으로 받을 때의 상태를 알아보자면, 커피나 차를 뽑을수 있을 만큼의 충분한 돈이 있다면  nomoney를 0로 만들어서 output으로 내보내면 자판기에 커피나 차를 뽑을 만큼의 충분한 돈이 있다고 알려줄 수 있다. 하지만 자판기에 커피나 차를 뽑을 만큼의 충분한 돈이 존재하지 않는다면, 차나 자판기의 출력은 0이 되
고, nomoney를 1로 출력하여 자판기에는 충분한 돈이 존재하지 않다는 것을 알려줄 수 있다. 마지막으로 반환을 하려는 상태를 알아보자면, 500원 
100원 50원은 한번에 한 개씩만 출력할수 있게 알고리즘을 구성하였고, 500원 100원 50원이 모두 출력되었다면 자판기가 가지고 있던 상태의 돈에서 650원을 뺀 금액을 다시 state로 돌려서 돈을 추가로 넣거나 또다시 return을 하게끔 하는 프로그램을 구성하였다.

#### 시나리오 #1

소희가 500원짜리 동전을 1개를 넣어서 커피 2잔을 뽑아 먹고 부족한 나머지 차를 한 잔 더 마셨다. 그 이후, 소희는 100원을 거슬러 받았다.

![시뮬레이션1번](https://user-images.githubusercontent.com/45071833/102355525-4f979580-3fef-11eb-896a-01a03bdfc7ab.jpg)

#### 시나리오 #2

소희가 수업시간 1분전에 차를 1 잔 뽑아먹기 위해서 100원짜리 동전을 5개 넣었다. 수업시간이 다되어 마음이 급한 나머지 거스름돈을 깜빡하고 그대로 두고 수업에 들어가버렸다. 그 뒤에 혜진이가 교수님께 드릴 커피를 뽑기 위해 돈을 넣으려는 순간 자판기에 400원이 남아있다는 사실을 알게 되었다. 혜진이는 몰래 남은 돈으로 커피를 두 잔 뽑았다. 혜진이는 사실을 숨기기 위해 거스름돈을 반환하고 들고 가버렸다. 

![시뮬레이션2번](https://user-images.githubusercontent.com/45071833/102355533-545c4980-3fef-11eb-90f9-1c417877a79c.JPG)


#### 시나리오 #3

소희가 커피 심부름을 받아서 커피(150원 )4잔을 뽑기 위해 100원짜리 6개 600원을 넣었다. 

![시뮬레이션3번](https://user-images.githubusercontent.com/45071833/102355541-56260d00-3fef-11eb-8467-3b4f49dacfe7.jpg)

